---
title: v8引擎内存笔记
date: 2019-10-18 16:03:21
categories: 底层
---
 
 ## 大小
 PC端 v8   新生代 老生代

 64位 1.4G 64MB   1400MB

 32位 0.7G 16MB   700MB

为什么分配到的大小是这些？
- 浏览器运行的js不是持久化的，对这些程序来说足够了
- js垃圾回收时，会暂停所有的代码的执行，300MB 0.5s 太多的话，页面就会有好几秒的暂停时间

## 包含

1. 新生代内存
- from
- to 
 
  阈值：25%, 经历过一次循环 && 大于阈值 -> 该变量就放入老生代
  消耗空间，节省时间

  最初：from 有'a, b, c'三个变量
  一段时间后：'a, b'变量被回收, 则把'c'放入 to, 清空from所有的变量
  循环~

2. 老生代内存（占绝大部分）
  标记清除整理

## 优化内存
- 尽量少用全局变量
- 用的话记得释放
- 用立刻执行函数包裹

## 内存泄漏
- 滥用缓存
- 大内存量操作 大文件上传 分片上传/断点续传